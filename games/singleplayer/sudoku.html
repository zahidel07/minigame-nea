<html>
    <head>
        <meta charset="utf-8">
        <title>Wordle</title>
        <link href="../../main.css" rel="stylesheet" />
        <link href="sudoku.css" rel="stylesheet" />
        <script>
            let currentSelected = [-1, -1]
            let grid = Array(9).fill(Array(9).fill(null))
            let prefillIndexes = []
            let prefillNumbers = []
            let listening = false

            const numberPress = (key) => {
                if (currentSelected[0] === -1 && currentSelected[1] === -1) return toggleListener()
                else if (prefillIndexes.some(ind => ind[0] === currentSelected[0] && ind[1] === currentSelected[1])) return
                const { code } = key
                if (code.startsWith("Digit") || code.startsWith("Numpad")) {
                    const digit = code.startsWith("Digit") ? Number(code[5]) : Number(code[6])
                    if (digit === 0) return
                    else if (digit === grid[currentSelected[0]][currentSelected[1]]) {
                        grid[currentSelected[0]] = grid[currentSelected[0]].map((elem, ind) => ind === currentSelected[1] ? null : elem)
                    } else {
                        grid[currentSelected[0]] = grid[currentSelected[0]].map((elem, ind) => ind === currentSelected[1] ? digit : elem)
                    }
                    updateGrid()
                } else if (code === 'Backspace') {
                    if (!!grid[currentSelected[0]][currentSelected[1]]) {
                        grid[currentSelected[0]] = grid[currentSelected[0]].map((elem, ind) => ind === currentSelected[1] ? null : elem)
                        updateGrid()
                    } else return
                } else return
            }

            function fillRandom() {
                let randRow = Math.floor(Math.random() * 9)
                let randCol = Math.floor(Math.random() * 9)
                let randNum = Math.ceil(Math.random() * 9)
                for (let i = 0; i < 21; i++) {
                    while (
                        !!grid[randRow][randCol] || prefillIndexes
                        .filter(i => !!i)
                        .some((ind, i) => isInSameRowColOrBox(ind, [randRow, randCol]) && grid[ind[0]][ind[1]] === randNum)
                    ) {
                        randRow = Math.floor(Math.random() * 9)
                        randCol = Math.floor(Math.random() * 9)
                        randNum = Math.ceil(Math.random() * 9)
                    }
                    grid[randRow] = grid[randRow].map((elem, i) => i === randCol ? randNum : elem)
                    prefillIndexes.push([randRow, randCol])
                    prefillNumbers.push(randNum)
                }
                updateGrid()
            }

            function updateGrid() {
                [...document.getElementsByClassName('game-square')]
                .forEach((elem, elemInd) => {
                    const rowInd = Math.floor(elemInd / 9)
                    const colInd = elemInd % 9
                    elem.innerHTML = grid[rowInd][colInd]
                    if (currentSelected[0] === -1 && currentSelected[1] === -1) {
                        elem.setAttribute('class', 'game-square')
                    } else {
                        if (rowInd === currentSelected[0] && colInd === currentSelected[1]) elem.setAttribute('class', 'game-square selected')
                        else if (isInSameRowColOrBox(currentSelected, [rowInd, colInd])) elem.setAttribute('class', 'game-square pseudoselected')
                        else elem.setAttribute('class', 'game-square')
                    }
                })
            }

            function updateSquare(square) {
                const sqRow = Math.floor(square / 9)
                const sqCol = square % 9
                if (sqRow === currentSelected[0] && sqCol === currentSelected[1]) {
                    currentSelected = [-1, -1]
                } else {
                    currentSelected = [sqRow, sqCol]
                }
                toggleListener()
                updateGrid()
            } 

            function toggleListener() {
                listening = !(currentSelected[0] === -1 && currentSelected[1] === -1)
                if (listening) document.body.addEventListener('keydown', numberPress)
                else document.body.removeEventListener('keydown', numberPress)
            }

            function isInSameRowColOrBox(square1, square2) {
                return square1[0] === square2[0]
                || square1[1] === square2[1]
                || (
                    Math.floor(square1[0] / 3) === Math.floor(square2[0] / 3) 
                    && Math.floor(square1[1] / 3) === Math.floor(square2[1] / 3)
                )
            }

            function elementsMatch(square1, square2) {
                return (!!grid[square1[0]][square1[1]] || !!grid[square2[0]][square2[1]]) 
                && grid[square1[0]][square1[1]] === grid[square2[0]][square2[1]]
            }

            fillRandom()
        </script>
    </head>
    <body>
        <div class="header">
            <h1>Sudoku</h1>
            <a href="../../homepage.html">Return to Home</a>
        </div>
        <hr>
        <p id="current">Fill in each box with numbers 1 to 9. A number in a square cannot appear again anywhere in any square in the same row, same column or same 3x3 box.</p>
        <div class="gamebox">
            <div class="row">
                <button class="game-square" id="sq0" onclick="updateSquare(0)"></button>
                <button class="game-square" id="sq1" onclick="updateSquare(1)"></button>
                <button class="game-square" id="sq2" onclick="updateSquare(2)"></button>
                <button class="game-square" id="sq3" onclick="updateSquare(3)"></button>
                <button class="game-square" id="sq4" onclick="updateSquare(4)"></button>
                <button class="game-square" id="sq5" onclick="updateSquare(5)"></button>
                <button class="game-square" id="sq6" onclick="updateSquare(6)"></button>
                <button class="game-square" id="sq7" onclick="updateSquare(7)"></button>
                <button class="game-square" id="sq8" onclick="updateSquare(8)"></button>
            </div>
            <div class="row">
                <button class="game-square" id="sq9" onclick="updateSquare(9)"></button>
                <button class="game-square" id="sq10" onclick="updateSquare(10)"></button>
                <button class="game-square" id="sq11" onclick="updateSquare(11)"></button>
                <button class="game-square" id="sq12" onclick="updateSquare(12)"></button>
                <button class="game-square" id="sq13" onclick="updateSquare(13)"></button>
                <button class="game-square" id="sq14" onclick="updateSquare(14)"></button>
                <button class="game-square" id="sq15" onclick="updateSquare(15)"></button>
                <button class="game-square" id="sq16" onclick="updateSquare(16)"></button>
                <button class="game-square" id="sq17" onclick="updateSquare(17)"></button>
            </div>
            <div class="row">
                <button class="game-square" id="sq18" onclick="updateSquare(18)"></button>
                <button class="game-square" id="sq19" onclick="updateSquare(19)"></button>
                <button class="game-square" id="sq20" onclick="updateSquare(20)"></button>
                <button class="game-square" id="sq21" onclick="updateSquare(21)"></button>
                <button class="game-square" id="sq22" onclick="updateSquare(22)"></button>
                <button class="game-square" id="sq23" onclick="updateSquare(23)"></button>
                <button class="game-square" id="sq24" onclick="updateSquare(24)"></button>
                <button class="game-square" id="sq25" onclick="updateSquare(25)"></button>
                <button class="game-square" id="sq26" onclick="updateSquare(26)"></button>
            </div>
            <div class="row">
                <button class="game-square" id="sq27" onclick="updateSquare(27)"></button>
                <button class="game-square" id="sq28" onclick="updateSquare(28)"></button>
                <button class="game-square" id="sq29" onclick="updateSquare(29)"></button>
                <button class="game-square" id="sq30" onclick="updateSquare(30)"></button>
                <button class="game-square" id="sq31" onclick="updateSquare(31)"></button>
                <button class="game-square" id="sq32" onclick="updateSquare(32)"></button>
                <button class="game-square" id="sq33" onclick="updateSquare(33)"></button>
                <button class="game-square" id="sq34" onclick="updateSquare(34)"></button>
                <button class="game-square" id="sq35" onclick="updateSquare(35)"></button>
            </div>
            <div class="row">
                <button class="game-square" id="sq36" onclick="updateSquare(36)"></button>
                <button class="game-square" id="sq37" onclick="updateSquare(37)"></button>
                <button class="game-square" id="sq38" onclick="updateSquare(38)"></button>
                <button class="game-square" id="sq39" onclick="updateSquare(39)"></button>
                <button class="game-square" id="sq40" onclick="updateSquare(40)"></button>
                <button class="game-square" id="sq41" onclick="updateSquare(41)"></button>
                <button class="game-square" id="sq42" onclick="updateSquare(42)"></button>
                <button class="game-square" id="sq43" onclick="updateSquare(43)"></button>
                <button class="game-square" id="sq44" onclick="updateSquare(44)"></button>
            </div>
            <div class="row">
                <button class="game-square" id="sq45" onclick="updateSquare(45)"></button>
                <button class="game-square" id="sq46" onclick="updateSquare(46)"></button>
                <button class="game-square" id="sq47" onclick="updateSquare(47)"></button>
                <button class="game-square" id="sq48" onclick="updateSquare(48)"></button>
                <button class="game-square" id="sq49" onclick="updateSquare(49)"></button>
                <button class="game-square" id="sq50" onclick="updateSquare(50)"></button>
                <button class="game-square" id="sq51" onclick="updateSquare(51)"></button>
                <button class="game-square" id="sq52" onclick="updateSquare(52)"></button>
                <button class="game-square" id="sq53" onclick="updateSquare(53)"></button>
            </div>
            <div class="row">
                <button class="game-square" id="sq54" onclick="updateSquare(54)"></button>
                <button class="game-square" id="sq55" onclick="updateSquare(55)"></button>
                <button class="game-square" id="sq56" onclick="updateSquare(56)"></button>
                <button class="game-square" id="sq57" onclick="updateSquare(57)"></button>
                <button class="game-square" id="sq58" onclick="updateSquare(58)"></button>
                <button class="game-square" id="sq59" onclick="updateSquare(59)"></button>
                <button class="game-square" id="sq60" onclick="updateSquare(60)"></button>
                <button class="game-square" id="sq61" onclick="updateSquare(61)"></button>
                <button class="game-square" id="sq62" onclick="updateSquare(62)"></button>
            </div>
            <div class="row">
                <button class="game-square" id="sq63" onclick="updateSquare(63)"></button>
                <button class="game-square" id="sq64" onclick="updateSquare(64)"></button>
                <button class="game-square" id="sq65" onclick="updateSquare(65)"></button>
                <button class="game-square" id="sq66" onclick="updateSquare(66)"></button>
                <button class="game-square" id="sq67" onclick="updateSquare(67)"></button>
                <button class="game-square" id="sq68" onclick="updateSquare(68)"></button>
                <button class="game-square" id="sq69" onclick="updateSquare(69)"></button>
                <button class="game-square" id="sq70" onclick="updateSquare(70)"></button>
                <button class="game-square" id="sq71" onclick="updateSquare(71)"></button>
            </div>
            <div class="row">
                <button class="game-square" id="sq72" onclick="updateSquare(72)"></button>
                <button class="game-square" id="sq73" onclick="updateSquare(73)"></button>
                <button class="game-square" id="sq74" onclick="updateSquare(74)"></button>
                <button class="game-square" id="sq75" onclick="updateSquare(75)"></button>
                <button class="game-square" id="sq76" onclick="updateSquare(76)"></button>
                <button class="game-square" id="sq77" onclick="updateSquare(77)"></button>
                <button class="game-square" id="sq78" onclick="updateSquare(78)"></button>
                <button class="game-square" id="sq79" onclick="updateSquare(79)"></button>
                <button class="game-square" id="sq80" onclick="updateSquare(80)"></button>
            </div>
        </div>
    </body>
</html>
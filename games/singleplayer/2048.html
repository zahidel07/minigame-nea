<html>
    <head>
        <meta charset="utf-8">
        <title>2048</title>
        <link href="../../main.css" rel="stylesheet" />
        <link href="2048.css" rel="stylesheet" />
        <script>
            let grid = Array(4).fill(Array(4).fill(null))

            function updateGrid() {
                grid.forEach((row, rowInd) => {
                    row.forEach((col, colInd) => {
                        const gridElem = document.getElementById(`sq${rowInd * 4 + colInd}`)
                        if (col !== null) {
                            gridElem.setAttribute('class', 'game-square occupied') 
                            gridElem.innerText = col
                        } else {
                            gridElem.setAttribute('class', 'game-square')
                            gridElem.innerText = '-'
                        }
                    })
                })
            }
            
            function addRandom() {
                let randomRow = Math.floor(Math.random() * 4)
                let randomCol = Math.floor(Math.random() * 4)
                while (grid[randomRow][randomCol]) {
                    randomRow = Math.floor(Math.random() * 4)
                    randomCol = Math.floor(Math.random() * 4)
                }
                grid[randomRow] = grid[randomRow].map((elem, ind) => ind === randomCol ? 2 : elem)
                updateGrid()
            }

            function moveGridLeft() {
                grid.map(row => sortNumsL(row))
                updateGrid()
            }

            function moveGridRight() {
                grid.map(row => sortNumsR(row))
                updateGrid()
            }

            function moveGridDown() {
                // fix for 06/02/2025
            }

            function moveGridUp() {
                // fix for 06/02/2025
            }

            function sortNumsL(array) {
                array.sort((first, second) => {
                    if (first === null && second !== null) return 1
                    else if (first !== null && second === null) return -1
                    else return 0
                })
                array = mergeNumsL(array)
                return array            
            }

            function sortNumsR(array) {
                array.sort((first, second) => {
                    if (first === null && second !== null) return -1
                    else if (first !== null && second === null) return 1
                    else return 0
                })
                array = mergeNumsR(array)
                return array
            }

            function mergeNumsL(array) {
                for (let ind = 1; ind < array.length; ind++) {
                    if (array[ind] === null || array[ind - 1] === null) return
                    else if (array[ind] === array[ind - 1]) {
                        array[ind - 1] = array[ind] * 2
                        array[ind] = null
                    }
                }
                return array
            }

            function mergeNumsR(array) {
                for (let ind = 1; ind < array.length; ind++) {
                    if (array[ind] === null || array[ind - 1] === null) return
                    else if (array[ind] === array[ind - 1]) {
                        array[ind] = array[ind - 1] * 2
                        array[ind - 1] = null
                    }
                }
                return array
            }

            function checkAvailableGridSpaces() {
                return grid.flat().some(elem => elem === null)
            }
        </script>
    </head>
    <body>
        <script>
            document.body.addEventListener("keydown", (keyEvent) => {
                const keyPressed = keyEvent.code
                switch (keyPressed) {
                    case "ArrowLeft":
                    case "KeyA":
                        moveGridLeft()
                        break
                    case "ArrowRight":
                    case "KeyD":
                        moveGridRight()
                        break
                    case "ArrowDown":
                    case "KeyS":
                        moveGridDown()
                        break
                    case "ArrowUp":
                    case "KeyW":
                        moveGridUp()
                        break
                    default: 
                        addRandom()
                        break
                }
            })
        </script>
        <div class="header">
            <h1>2048</h1>
            <a href="../../homepage.html">Return to Home</a>
        </div>
        <hr>
        <div class="gamebox">
            <div class="row">
                <button class="game-square" id="sq0" disabled>-</button>
                <button class="game-square" id="sq1" disabled>-</button>
                <button class="game-square" id="sq2" disabled>-</button>
                <button class="game-square" id="sq3" disabled>-</button>
            </div>
            <div class="row">
                <button class="game-square" id="sq4" disabled>-</button>
                <button class="game-square" id="sq5" disabled>-</button>
                <button class="game-square" id="sq6" disabled>-</button>
                <button class="game-square" id="sq7" disabled>-</button>
            </div>
            <div class="row">
                <button class="game-square" id="sq8" disabled>-</button>
                <button class="game-square" id="sq9" disabled>-</button>
                <button class="game-square" id="sq10" disabled>-</button>
                <button class="game-square" id="sq11" disabled>-</button>
            </div>
            <div class="row">
                <button class="game-square" id="sq12" disabled>-</button>
                <button class="game-square" id="sq13" disabled>-</button>
                <button class="game-square" id="sq14" disabled>-</button>
                <button class="game-square" id="sq15" disabled>-</button>
            </div>
        </div>
    </body>
</html>